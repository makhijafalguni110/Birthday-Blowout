<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Blow Out the Candles Cake</title>
<style>
  body {
    background: #fbeed8;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    color: #5a3e1b;
    text-align: center;
    padding: 40px 20px;
    overflow-x: hidden;
  }
  h1 {
    margin-bottom: 30px;
    font-weight: 700;
    letter-spacing: 1.5px;
  }
  .cake-container {
    position: relative;
    width: 320px;
    margin: 0 auto 40px auto;
  }
  .cake-layer {
    width: 320px;
    height: 80px;
    background: linear-gradient(135deg, #d2691e 0%, #8b4513 100%);
    border-radius: 25px 25px 20px 20px;
    box-shadow: inset 0 6px 10px #b05a1e, 0 8px 15px rgba(0,0,0,0.2);
    position: relative;
    margin-bottom: 10px;
  }
  .cake-icing {
    position: absolute;
    width: 320px;
    height: 25px;
    background: linear-gradient(90deg, #ffd6d6 0%, #ff6f91 100%);
    border-radius: 30px 30px 0 0;
    top: -20px;
    left: 0;
    box-shadow: 0 2px 8px #ff89a1;
    z-index: 10;
  }
  .plate {
    width: 360px;
    height: 40px;
    background: radial-gradient(circle at center, #deb887 30%, #a0522d 90%);
    border-radius: 50% / 100%;
    margin: -10px auto 0 auto;
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    position: relative;
    z-index: -1;
  }
  .candle {
    position: absolute;
    width: 18px;
    height: 60px;
    background: #fff9e6;
    border-radius: 4px;
    box-shadow: inset 0 0 6px #e8d49f;
    bottom: 140px;
  }
  .candle:nth-child(1) { left: 50px; }
  .candle:nth-child(2) { left: 110px; }
  .candle:nth-child(3) { left: 170px; }
  .candle:nth-child(4) { left: 230px; }
  .candle:nth-child(5) { left: 290px; }
  .candle::before {
    content: '';
    position: absolute;
    width: 4px;
    height: 100%;
    background: repeating-linear-gradient(
      45deg,
      #f1c40f,
      #f1c40f 6px,
      #f39c12 6px,
      #f39c12 12px
    );
    border-radius: 3px;
    left: 7px;
    top: 0;
  }
  .flame {
    position: absolute;
    top: -40px;
    left: 50%;
    transform: translateX(-50%);
    width: 16px;
    height: 28px;
    background: radial-gradient(circle at 50% 35%, #fff700, #ff4500 80%);
    border-radius: 50% 50% 50% 50% / 70% 70% 30% 30%;
    filter: drop-shadow(0 0 6px orange);
    animation: flicker 1s infinite alternate;
    box-shadow: 0 0 12px 3px rgba(255,165,0,0.6);
    z-index: 20;
  }
  @keyframes flicker {
    0% { transform: translateX(-50%) scale(1); opacity: 1; }
    100% { transform: translateX(calc(-50% + 3px)) scale(1.1); opacity: 0.7; }
  }
  #message {
    display: none;
    font-size: 2rem;
    margin-top: 50px;
    color: #e91e63;
    font-weight: 700;
    text-shadow: 0 0 8px #f48fb1;
  }
  .balloon {
    position: fixed;
    bottom: -100px;
    border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
    opacity: 0.8;
    animation: rise 6s ease-in forwards;
    box-shadow: 0 0 6px rgba(0,0,0,0.15);
  }
  .balloon.red { background: #ff6b6b; }
  .balloon.pink { background: #ff9ff3; }
  .balloon.orange { background: #ff9f43; }
  .balloon.yellow { background: #feca57; }
  .balloon.green { background: #48dbfb; }
  @keyframes rise {
    0% { transform: translateY(0) scale(1); opacity: 0.8; }
    100% { transform: translateY(-120vh) scale(1.1); opacity: 0; }
  }
</style>
</head>
<body>

<h1>Blow Into Your Mic to Blow Out the Candles!</h1>

<div class="cake-container">
  <div class="cake-layer"></div>
  <div class="cake-icing"></div>
  <div class="cake-layer"></div>
  <div class="plate"></div>
</div>

<div class="cake-container" id="cake"></div>

<div id="message">ðŸŽ‰ Happy Birthday! ðŸŽ‰</div>
<!-- <div> <p1>Tera birthday aaya,<br/>
    Socha kuch special karun...<br/>
    Phir yaad aaya â€” tu khud hi ek special case hai! ðŸ˜‚ðŸŽ‰</p1></div><br/><br/>
<div><p2>Another year of tolerating your weirdnessâ€¦ and honestly,<br/>
   itâ€™s been a blast. Cheers!</p2></div> -->
    

<audio id="birthdaySong" preload="auto">
  <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
  Your browser does not support the audio element.
</audio>

<script>
const cake = document.getElementById('cake');
const message = document.getElementById('message');
const birthdaySong = document.getElementById('birthdaySong');

const candlesCount = 5;
let blownCount = 0;

// Create candles
for (let i = 0; i < candlesCount; i++) {
  const candle = document.createElement('div');
  candle.className = 'candle';
  candle.style.left = `${50 + i * 60}px`;

  const flame = document.createElement('div');
  flame.className = 'flame';
  candle.appendChild(flame);

  cake.appendChild(candle);
}

// Start mic detection
async function initMic() {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const mic = audioContext.createMediaStreamSource(stream);
    const analyser = audioContext.createAnalyser();
    mic.connect(analyser);
    const dataArray = new Uint8Array(analyser.fftSize);

    function detectBlow() {
      analyser.getByteTimeDomainData(dataArray);
      let max = 0;
      for (let i = 0; i < dataArray.length; i++) {
        const val = Math.abs(dataArray[i] - 128);
        if (val > max) max = val;
      }
      if (max > 20) { 
        blowCandle();
      }
      requestAnimationFrame(detectBlow);
    }
    detectBlow();
  } catch (err) {
    alert('Microphone access is required!');
    console.error(err);
  }
}

function blowCandle() {
  const flames = document.querySelectorAll('.flame');
  for (const flame of flames) {
    if (flame.style.display !== 'none') {
      flame.style.display = 'none';
      blownCount++;
      break;
    }
  }
  if (blownCount === candlesCount) {
    celebrate();
  }
}

function celebrate() {
  message.style.display = 'block';
  launchBalloons();
  
  // Play the birthday song
  birthdaySong.currentTime = 0;
  birthdaySong.loop = true;
  const playPromise = birthdaySong.play();
  
  if (playPromise !== undefined) {
    playPromise.catch(error => {
      console.log("Auto-play was prevented, showing play button");
      // Show a play button or handle the error
    });
  }
}

function launchBalloons() {
  const colors = ['red', 'pink', 'orange', 'yellow', 'green'];
  for (let i = 0; i < 10; i++) {
    const balloon = document.createElement('div');
    balloon.classList.add('balloon');
    balloon.classList.add(colors[i % colors.length]);
    balloon.style.left = `${Math.random() * 100}vw`;
    balloon.style.animationDelay = `${i * 0.5}s`;
    balloon.style.width = `${20 + Math.random() * 15}px`;
    balloon.style.height = `${30 + Math.random() * 20}px`;
    document.body.appendChild(balloon);

    balloon.addEventListener('animationend', () => {
      balloon.remove();
    });
  }
}

// Force a small user click to unlock audio
document.body.addEventListener('click', () => {
  // Try to play and immediately pause to unlock audio
  birthdaySong.play().then(() => {
    birthdaySong.pause();
    birthdaySong.currentTime = 0;
  }).catch(() => {});
}, { once: true });

initMic();
</script>

</body>
</html>